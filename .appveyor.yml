image: macos

branches:
  only:
    - master

environment:
  access_token:
    secure: 1Ep5ZXTk0f1AbqY1xVTGnHWDEEBnSm2RnlExqhH0AsAPS1cRYl9aJRHDonSioUOD

before_build:
- sudo npm i minify -g
- pip3 install pandas --user

build_script:
- ./build.py

after_build:
- git config --global credential.helper store
- echo "https://${access_token}:x-oauth-basic@github.com" >> ~/.git-credentials
- git config --global user.email "32255369+chromezh@users.noreply.github.com"
- git config --global user.name "sgalal"
- mv brogue2.js ..
- git checkout gh-pages
- git clean -xdf
- mv ../brogue2.js .
- git add .
- |-
  if [ -n "$(git status --porcelain)" ]; then
    git commit -m "Deploy $APPVEYOR_REPO_COMMIT by AppVeyor"
    git push origin gh-pages
  fi
